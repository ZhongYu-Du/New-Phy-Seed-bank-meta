---
title: "Ordinations PCA"
author: "Eduardo Fern√°ndez Pascual"
date: "19/6/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r message = FALSE, echo = FALSE, warning = FALSE}
library(tidyverse); library(here)

read.csv(here("data", "Elevations", "Regions.csv")) %>%
  merge(read.csv(here("results", "database", "germination.csv")), by = "Region", all = TRUE) %>%
  merge(read.csv(here("results", "database", "traits.csv")), by = "TPLName") %>%
  mutate(Region = as.character(Region),
         Region = ifelse(is.na(Macroregion), "Enscobase", Region),
         Region = ifelse(Region %in% c("Northern Alps", "Southern Alps"), "Alps", Region),
         Region = ifelse(Region %in% c("Central Andes", "Southern Andes"), "Andes", Region),
         Region = ifelse(Region %in% c("Qinghai-Tibet Plateau"), "Qinghai-Tibet", Region),
         Region = ifelse(Region %in% c("Cantabrian Mountains"), "Cantabrian Mts", Region),     
         Region = as.factor(Region)) -> dataset

# Numbers for the main text

dataset %>% summary
dataset %>% pull(Region) %>% unique %>% length -> MSregions
dataset %>% tally() -> MSrecords
dataset %>% pull(Source) %>% unique %>% length -> MSgroups
read.csv("../../../#tpl/results/TPLNames.csv") %>% 
  select(Taxon, Family) %>%
  unique %>%
  merge(dataset, by = "Taxon", all.y = TRUE) %>%
  pull(Family) %>% unique %>% length -> MSfamilies
dataset %>% pull(TPLName) %>% unique %>% length -> MSspecies
dataset %>% filter(Alpine == "Strict") %>% pull(TPLName) %>% unique %>% length -> MSstrict
dataset %>% filter(Alpine == "Generalist") %>% pull(TPLName) %>% unique %>% length -> MSgeneral
dataset$Germinable %>% sum -> MSseeds
dataset %>% pull(Tmean) %>% min -> MSminT
dataset %>% pull(Tmean) %>% max -> MSmaxT
dataset %>% filter(Alternating == "Y") %>% tally -> MSaltY
dataset %>% filter(Alternating == "N") %>% tally -> MSaltN
dataset %>% filter(Light == "Y") %>% tally -> MSlightY
dataset %>% filter(Light == "N") %>% tally -> MSlightN
dataset %>% filter(Stratification == "None") %>% tally -> MSstratN
dataset %>% filter(Stratification == "Cold") %>% tally -> MSstratCold
dataset %>% filter(Scarification == "Y") %>% tally -> MSscarY
dataset %>% filter(GA3 == "Y") %>% tally -> MSga3

# Map figure

dataset %>%
  group_by(Region) %>%
  summarise(Longitude = mean(Longitude.x), Latitude = mean(Latitude.x),
            Records =length(TPLName),
            Species = length(unique(TPLName))) -> dfRecords

dataset %>%
  filter(Alpine == "Strict") %>%
  group_by(Region) %>%
  summarise(Strict = length(unique(TPLName))) -> dfStricts

dfRecords %>%
  merge(dfStricts) %>%
  data.frame -> dfNumbers

library(maps); library(mapdata); library(extrafont)

load("../../../#wwfmap/alpinemap/results/alpinemap.RData")

dfNumbers %>%
  ggplot(aes(Longitude, Latitude)) +
  geom_polygon(data = map_data("world"), aes(x = long, y = lat, group = group),
               color = "grey96", fill = "grey96") +
  geom_polygon(data = testolin_simple, aes(x = long, y = lat, group = group),
               color = "purple", fill = "purple") +
  geom_label(aes(label = rownames(dfNumbers)), size = 2.5,
             label.padding = unit(0.1, "lines"),
             label.r = unit(0.25, "lines"),
             alpha = 0.6, fill = "gold") +
  guides(size = F) +
  coord_cartesian(xlim = c(-180, 180), ylim = c(-49, 80)) +
  ggthemes::theme_tufte() +
  theme(axis.line=element_blank(), axis.text.x=element_blank(),
        axis.text.y=element_blank(), axis.ticks=element_blank(),
        axis.title.x=element_blank(), axis.title.y=element_blank(),
        panel.background=element_blank(),
        panel.border=element_blank(), panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(), plot.background=element_blank(),
        legend.title = element_blank(),
        legend.position = "none",
        legend.text = element_text(margin = margin(r = 11, unit = "pt"))) -> p1

dfNumbers %>%
  select(Region, Records, Species, Strict) %>%
  gridExtra::tableGrob(theme = gridExtra::ttheme_minimal(
    core = list(fg_params = list(cex = .6, hjust = 1, x = 0.9, fontfamily = "serif")),
    colhead = list(fg_params = list(cex = .6, hjust = 1, x = 0.9, fontfamily = "serif")),
    rowhead = list(fg_params = list(cex = .6), fontfamily = "serif"))) -> TableMap

gridExtra::arrangeGrob(p1, TableMap, ncol = 2, widths = 3:2) -> fig1

# Figure 2: description of seed dormancy, mass, embryo

dataset %>%
  select(TPLName, Alpine, Dormancy) %>%
  na.omit %>%
  unique %>%
  group_by(Alpine, Dormancy) %>%
  tally %>%
  ggplot(aes(Alpine, n, fill = Dormancy)) +
  geom_col(position = "fill") +
  labs(y = "Frequency", title = "(A) Seed dormancy classes") +
  ggthemes::theme_tufte() +
  theme(legend.position = "right", axis.title.x = element_blank(),
        panel.background = element_rect(color = "grey96", fill = "grey96"),
        axis.text.x = element_text(size = 7)) +
  scale_fill_manual(values = c("olivedrab", "yellowgreen", "turquoise4", "gold", "purple")) -> fig2a

dataset %>%
  select(TPLName, Alpine, Seed.mass) %>%
  na.omit %>%
  unique %>%
  ggplot(aes(Alpine, log(Seed.mass), fill = Alpine)) +
  geom_boxplot() +
  labs(y = "Seed mass (log)", title = "(B) Seed mass") +
  ggthemes::theme_tufte() +
  theme(legend.position = "right", axis.title.x = element_blank(),
        panel.background = element_rect(color = "grey96", fill = "grey96"),
        axis.text.x = element_text(size = 7)) +
  scale_fill_manual(values = c("yellowgreen", "gold")) -> fig2b

dataset %>%
  select(TPLName, Alpine, Embryo) %>%
  na.omit %>%
  unique %>%
  ggplot(aes(Alpine, Embryo, fill = Alpine)) +
  geom_boxplot() +
  labs(y = "Embryo:endosperm", title = "(C) Embryo to endosperm ratio") +
  ggthemes::theme_tufte() +
  theme(legend.position = "right", axis.title.x = element_blank(),
        panel.background = element_rect(color = "grey96", fill = "grey96"),
        axis.text.x = element_text(size = 7)) +
  scale_fill_manual(values = c("yellowgreen", "gold")) -> fig2c

gridExtra::arrangeGrob(fig2a, fig2b, fig2c, ncol = 1) -> fig2

# Figure 3 - MCMC

rbind(
  rbind(
    read.csv(here("results", "analysis", "proportion", "alpR.germ.general.csv")) %>%
      select(model, post.mean, l.95..CI, u.95..CI, pMCMC) %>%
      mutate(Moderator = "Alone"),
    read.csv(here("results", "analysis", "proportion", "alpR.germ.general.embryo.csv")) %>%
      select(model, post.mean, l.95..CI, u.95..CI, pMCMC) %>% 
      mutate(Moderator = "Embryo"),
    read.csv(here("results", "analysis", "proportion", "alpR.germ.general.mass.csv")) %>%
      select(model, post.mean, l.95..CI, u.95..CI, pMCMC) %>% 
      mutate(Moderator = "Mass")) %>%
    rename(Mean = post.mean,
           Lower = l.95..CI,
           Upper = u.95..CI,
           p = pMCMC,
           Treatment = model) %>%
    select(Moderator, Treatment, Mean, Lower, Upper, p),
  read.csv(here("results", "analysis", "proportion", "alpR.germ.type.csv")) %>%
    select(variable, post.mean, l.95..CI, u.95..CI, pMCMC) %>%
    separate(variable, into = c("Moderator", "Treatment"), sep = ":") %>%
    mutate(Moderator = gsub("Alpine", "", Moderator)) %>%
    rename(Mean = post.mean,
           Lower = l.95..CI,
           Upper = u.95..CI,
           p = pMCMC)) %>%
  mutate(Moderator = recode(Moderator, Strict = "Strict alpine spp.",
                            Generalist = "Generalist spp.",
                            Mass = "Seed mass",
                            Embryo = "Embryo:endosperm",
                            Alone = "Main effect"),
         Moderator = fct_relevel(Moderator, c("Embryo:endosperm", "Seed mass",  "Generalist spp.", "Strict alpine spp.", "Main effect")),
         Treatment = recode(Treatment, Tmean = "Temperature", GA3 = "GA[3]"),
         Treatment = fct_relevel(Treatment, c("Temperature", "Alternating", "Light", "Scarification", "Stratification", "GA[3]"))) %>%
  ggplot(aes(y = Moderator, x = Mean, 
             xmin = Lower, xmax = Upper,
             color = Moderator)) +
  facet_wrap(~ Treatment, labeller = label_parsed, nrow = 1) +
  geom_point(size = 1, alpha = 0.7) +
  labs(x = "Effect size", title = "(A) Effect on final germination proportions") +
  geom_errorbarh(height = .3) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  ggthemes::theme_tufte() +
  theme(legend.position = "none", axis.title.y = element_blank(),
        panel.background = element_rect(color = "grey96", fill = "grey96"),
        axis.text.y = element_text(color = c("olivedrab",  "turquoise4", "yellowgreen", "gold", "purple")),
        axis.text.x = element_text(size = 7)) +
  scale_color_manual(values = c("olivedrab",  "turquoise4", "yellowgreen", "gold", "purple")) -> fig1a

rbind(
  rbind(
    read.csv(here("results", "analysis", "mgt", "alpR.MGT.general.csv")) %>%
      select(model, post.mean, l.95..CI, u.95..CI, pMCMC) %>%
      mutate(Moderator = "Alone"),
    read.csv(here("results", "analysis", "mgt", "alpR.MGT.general.embryo.csv")) %>%
      select(model, post.mean, l.95..CI, u.95..CI, pMCMC) %>% 
      mutate(Moderator = "Embryo"),
    read.csv(here("results", "analysis", "mgt", "alpR.MGT.general.mass.csv")) %>%
      select(model, post.mean, l.95..CI, u.95..CI, pMCMC) %>% 
      mutate(Moderator = "Mass")) %>%
    rename(Mean = post.mean,
           Lower = l.95..CI,
           Upper = u.95..CI,
           p = pMCMC,
           Treatment = model) %>%
    select(Moderator, Treatment, Mean, Lower, Upper, p),
  read.csv(here("results", "analysis", "mgt", "alpR.MGT.type.csv")) %>%
    select(variable, post.mean, l.95..CI, u.95..CI, pMCMC) %>%
    separate(variable, into = c("Moderator", "Treatment"), sep = ":") %>%
    mutate(Moderator = gsub("Alpine", "", Moderator)) %>%
    rename(Mean = post.mean,
           Lower = l.95..CI,
           Upper = u.95..CI,
           p = pMCMC)) %>%
  filter(Mean < 0.5) %>%
  mutate(Moderator = recode(Moderator, Strict = "Strict alpine spp.",
                            Generalist = "Generalist spp.",
                            Mass = "Seed mass",
                            Embryo = "Embryo:endosperm",
                            Alone = "Main effect"),
         Moderator = fct_relevel(Moderator, c("Embryo:endosperm", "Seed mass",  "Generalist spp.", "Strict alpine spp.", "Main effect")),
         Treatment = recode(Treatment, Tmean = "Temperature", GA3 = "GA[3]"),
         Treatment = fct_relevel(Treatment, c("Temperature", "Alternating", "Light", "Scarification", "Stratification", "GA[3]"))) %>%
  ggplot(aes(y = Moderator, x = Mean, 
             xmin = Lower, xmax = Upper,
             color = Moderator)) +
  facet_wrap(~ Treatment, labeller = label_parsed, nrow = 1) +
  geom_point(size = 1, alpha = 0.7) +
  labs(x = "Effect size", title = "(B) Effect on mean germination time") +
  geom_errorbarh(height = .3) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  ggthemes::theme_tufte() +
  theme(legend.position = "none", axis.title.y = element_blank(),
        panel.background = element_rect(color = "grey96", fill = "grey96"),
        axis.text.y = element_text(color = c("olivedrab",  "turquoise4", "yellowgreen", "gold", "purple")),
        axis.text.x = element_text(size = 7)) +
  scale_color_manual(values = c("olivedrab",  "turquoise4", "yellowgreen", "gold", "purple")) -> fig1b

rbind(
  rbind(
    read.csv(here("results", "analysis", "unc", "alpR.UNC.general.csv")) %>%
      select(model, post.mean, l.95..CI, u.95..CI, pMCMC) %>%
      mutate(Moderator = "Alone"),
    read.csv(here("results", "analysis", "unc", "alpR.UNC.general.embryo.csv")) %>%
      select(model, post.mean, l.95..CI, u.95..CI, pMCMC) %>% 
      mutate(Moderator = "Embryo"),
    read.csv(here("results", "analysis", "unc", "alpR.UNC.general.mass.csv")) %>%
      select(model, post.mean, l.95..CI, u.95..CI, pMCMC) %>% 
      mutate(Moderator = "Mass")) %>%
    rename(Mean = post.mean,
           Lower = l.95..CI,
           Upper = u.95..CI,
           p = pMCMC,
           Treatment = model) %>%
    select(Moderator, Treatment, Mean, Lower, Upper, p),
  read.csv(here("results", "analysis", "unc", "alpR.UNC.type.csv")) %>%
    select(variable, post.mean, l.95..CI, u.95..CI, pMCMC) %>%
    separate(variable, into = c("Moderator", "Treatment"), sep = ":") %>%
    mutate(Moderator = gsub("Alpine", "", Moderator)) %>%
    rename(Mean = post.mean,
           Lower = l.95..CI,
           Upper = u.95..CI,
           p = pMCMC)) %>%
  filter(Mean < 0.5) %>%
  mutate(Moderator = recode(Moderator, Strict = "Strict alpine spp.",
                            Generalist = "Generalist spp.",
                            Mass = "Seed mass",
                            Embryo = "Embryo:endosperm",
                            Alone = "Main effect"),
         Moderator = fct_relevel(Moderator, c("Embryo:endosperm", "Seed mass",  "Generalist spp.", "Strict alpine spp.", "Main effect")),
         Treatment = recode(Treatment, Tmean = "Temperature", GA3 = "GA[3]"),
         Treatment = fct_relevel(Treatment, c("Temperature", "Alternating", "Light", "Scarification", "Stratification", "GA[3]"))) %>%
  ggplot(aes(y = Moderator, x = Mean, 
             xmin = Lower, xmax = Upper,
             color = Moderator)) +
  facet_wrap(~ Treatment, labeller = label_parsed, nrow = 1) +
  geom_point(size = 1, alpha = 0.7) +
  labs(x = "Effect size", title = "(C) Effect on germination uncertainty") +
  geom_errorbarh(height = .3) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  ggthemes::theme_tufte() +
  theme(legend.position = "none", axis.title.y = element_blank(),
        panel.background = element_rect(color = "grey96", fill = "grey96"),
        axis.text.y = element_text(color = c("olivedrab",  "turquoise4", "yellowgreen", "gold", "purple")),
        axis.text.x = element_text(size = 7)) +
  scale_color_manual(values = c("olivedrab",  "turquoise4", "yellowgreen", "gold", "purple")) -> fig1c

cowplot::plot_grid(fig1a, fig1b, fig1c, ncol = 1) -> fig3

# Figure 4 - Ordination

dataset %>%
  mutate(Macroregion = as.character(Macroregion),
         Macroregion = ifelse(is.na(Macroregion), "Europe", Macroregion),
         Germination = Germinated / Germinable,
         Scarification = ifelse(Scarification == "Y", 1, 0),
         Stratification = ifelse(Stratification == "None", 0, 1),
         GA3 = ifelse(GA3 == "Y", 1, 0),
         Light = ifelse(Light == "Y", 1, 0),
         Alternating = ifelse(Alternating == "Y", 1, 0)) %>%
  group_by(TPLName, Macroregion) %>%
  summarise(Temperature = weighted.mean(Tmean, w = Germination),
            Alternating = weighted.mean(Alternating, w = Germination),
            Light = weighted.mean(Light, w = Germination),
            Scarification = weighted.mean(Scarification, w = Germination),
            Stratification = weighted.mean(Stratification, w = Germination),
            GA3 = weighted.mean(GA3, w = Germination)) %>%
  merge(read.csv(here("results", "database", "traits.csv")), by = "TPLName") %>%
  select(TPLName, Macroregion, Alpine, Plant.category, Life.form, Lifespan, Reproduction.frequency, Dormancy, Seed.mass, Embryo, Temperature:GA3) %>%
  filter(!is.nan(Temperature)) %>% 
  mutate(Plant.category = fct_recode(Plant.category, Woody = "Herb, Woody", Woody = "Woody, Subshrub?"),
         Life.form = fct_recode(Life.form, T = "T, H", G = "H, G", CH = "H, CH", T = "T, Hydrophyt", CH = "CH, H", CH = "CH, NP", G = "G, H", H = "H, Hydrophyt"),
         Lifespan = fct_recode(Lifespan, annual = "annual, biennial", annual = "annual, perennial", perennial = "biennial", perennial = "biennial, perennial"),
         Reproduction.frequency = fct_recode(Reproduction.frequency, monocarp = "monocarp, ?polycarp", monocarp = "monocarp, polycarp")) -> traits

traits %>%
  select(Seed.mass:GA3) %>%
  FactoMineR::PCA(graph = FALSE) -> pcaAlpine

traits %>%
  select(-c(Seed.mass:GA3)) %>%
  cbind(pcaAlpine$ind$coord[, 1:2]) -> pcaInds

pcaAlpine$var$coord[, 1:2] %>%
  data.frame %>%
  rownames_to_column(var = "Variable") %>%
  mutate(Variable = fct_recode(Variable, `Seed mass` = "Seed.mass", 
                               `Embryo:endosperm` = "Embryo")) -> pcaVars

ggplot(pcaInds, aes(x = Dim.1, y = Dim.2)) +
  geom_text(aes(label = TPLName, color = Macroregion), size = 3, show.legend = T, alpha = 0.6, shape = 15) +
  ggthemes::theme_tufte() + 
  theme(panel.background = element_rect(color = "grey96", fill = "grey96"),
        legend.position = "top", legend.title = element_blank(),
        legend.text = element_text(size = 7.5),
        legend.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "cm"),
        plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
        text = element_text(size = 8)) +
  scale_color_manual(values = c("olivedrab",  "turquoise4", "gold", "purple")) +
  scale_x_continuous(name = paste("Axis 1 (", round(pcaAlpine$eig[1, 2], 0),
                                  "% variance explained)", sep = "")) + 
  scale_y_continuous(name = paste("Axis 2 (", round(pcaAlpine$eig[2, 2], 0), 
                                  "% variance explained)", sep = "")) +
  geom_segment(data = pcaVars, aes(x = 0, y = 0, xend = 4*Dim.1, yend = 4*Dim.2)) +
  geom_label(data = pcaVars, aes(x = 4*Dim.1, y = 4*Dim.2, label = Variable), 
                  size = 2.5)

ggplot(pcaInds, aes(x = Dim.1, y = Dim.2)) +
  geom_point(aes(color = Alpine), size = 3, show.legend = T, alpha = 0.6, shape = 15) +
  ggthemes::theme_tufte() + 
  theme(panel.background = element_rect(color = "grey96", fill = "grey96"),
        legend.position = "top", legend.title = element_blank(),
        legend.text = element_text(size = 7.5),
        legend.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "cm"),
        plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
        text = element_text(size = 8)) +
  scale_color_manual(values = c("yellowgreen", "gold")) +
  scale_x_continuous(name = paste("Axis 1 (", round(pcaAlpine$eig[1, 2], 0),
                                  "% variance explained)", sep = "")) + 
  scale_y_continuous(name = paste("Axis 2 (", round(pcaAlpine$eig[2, 2], 0), 
                                  "% variance explained)", sep = "")) +
  geom_segment(data = pcaVars, aes(x = 0, y = 0, xend = 4*Dim.1, yend = 4*Dim.2)) +
  geom_label(data = pcaVars, aes(x = 4*Dim.1, y = 4*Dim.2, label = Variable), 
             size = 2.5)

ggplot(pcaInds, aes(x = Dim.1, y = Dim.2)) +
  geom_point(aes(color = Life.form), size = 3, show.legend = T, alpha = 0.6, shape = 15) +
  ggthemes::theme_tufte() + 
  theme(panel.background = element_rect(color = "grey96", fill = "grey96"),
        legend.position = "top", legend.title = element_blank(),
        legend.text = element_text(size = 7.5),
        legend.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "cm"),
        plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
        text = element_text(size = 8)) +
  scale_color_manual(values = c("olivedrab",  "turquoise4", "gold", "purple", "yellowgreen", "indianred")) +
  scale_x_continuous(name = paste("Axis 1 (", round(pcaAlpine$eig[1, 2], 0),
                                  "% variance explained)", sep = "")) + 
  scale_y_continuous(name = paste("Axis 2 (", round(pcaAlpine$eig[2, 2], 0), 
                                  "% variance explained)", sep = "")) +
  geom_segment(data = pcaVars, aes(x = 0, y = 0, xend = 4*Dim.1, yend = 4*Dim.2)) +
  geom_label(data = pcaVars, aes(x = 4*Dim.1, y = 4*Dim.2, label = Variable), 
             size = 2.5)

ggplot(pcaInds, aes(x = Dim.1, y = Dim.2)) +
  geom_point(aes(color = Lifespan), size = 3, show.legend = T, alpha = 0.6, shape = 15) +
  ggthemes::theme_tufte() + 
  theme(panel.background = element_rect(color = "grey96", fill = "grey96"),
        legend.position = "top", legend.title = element_blank(),
        legend.text = element_text(size = 7.5),
        legend.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "cm"),
        plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
        text = element_text(size = 8)) +
  scale_color_manual(values = c("olivedrab",  "turquoise4", "gold", "purple", "yellowgreen", "indianred")) +
  scale_x_continuous(name = paste("Axis 1 (", round(pcaAlpine$eig[1, 2], 0),
                                  "% variance explained)", sep = "")) + 
  scale_y_continuous(name = paste("Axis 2 (", round(pcaAlpine$eig[2, 2], 0), 
                                  "% variance explained)", sep = "")) +
  geom_segment(data = pcaVars, aes(x = 0, y = 0, xend = 4*Dim.1, yend = 4*Dim.2)) +
  geom_label(data = pcaVars, aes(x = 4*Dim.1, y = 4*Dim.2, label = Variable), 
             size = 2.5)

ggplot(pcaInds, aes(x = Dim.1, y = Dim.2)) +
  geom_point(aes(color = Plant.category), size = 3, show.legend = T, alpha = 0.6, shape = 15) +
  ggthemes::theme_tufte() + 
  theme(panel.background = element_rect(color = "grey96", fill = "grey96"),
        legend.position = "top", legend.title = element_blank(),
        legend.text = element_text(size = 7.5),
        legend.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "cm"),
        plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
        text = element_text(size = 8)) +
  scale_color_manual(values = c("olivedrab",  "turquoise4", "gold", "purple", "yellowgreen", "indianred")) +
  scale_x_continuous(name = paste("Axis 1 (", round(pcaAlpine$eig[1, 2], 0),
                                  "% variance explained)", sep = "")) + 
  scale_y_continuous(name = paste("Axis 2 (", round(pcaAlpine$eig[2, 2], 0), 
                                  "% variance explained)", sep = "")) +
  geom_segment(data = pcaVars, aes(x = 0, y = 0, xend = 4*Dim.1, yend = 4*Dim.2)) +
  geom_label(data = pcaVars, aes(x = 4*Dim.1, y = 4*Dim.2, label = Variable), 
             size = 2.5)

ggplot(pcaInds, aes(x = Dim.1, y = Dim.2)) +
  geom_point(aes(color = Dormancy), size = 3, show.legend = T, alpha = 0.6, shape = 15) +
  ggthemes::theme_tufte() + 
  theme(panel.background = element_rect(color = "grey96", fill = "grey96"),
        legend.position = "top", legend.title = element_blank(),
        legend.text = element_text(size = 7.5),
        legend.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "cm"),
        plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
        text = element_text(size = 8)) +
  scale_color_manual(values = c("olivedrab",  "turquoise4", "gold", "purple", "yellowgreen", "indianred")) +
  scale_x_continuous(name = paste("Axis 1 (", round(pcaAlpine$eig[1, 2], 0),
                                  "% variance explained)", sep = "")) + 
  scale_y_continuous(name = paste("Axis 2 (", round(pcaAlpine$eig[2, 2], 0), 
                                  "% variance explained)", sep = "")) +
  geom_segment(data = pcaVars, aes(x = 0, y = 0, xend = 4*Dim.1, yend = 4*Dim.2)) +
  geom_label(data = pcaVars, aes(x = 4*Dim.1, y = 4*Dim.2, label = Variable), 
             size = 2.5)

traits %>%
  select(Plant.category, Lifespan, Reproduction.frequency, Dormancy, Seed.mass:GA3) %>%
  FactoMineR::FAMD(graph = FALSE) -> pcaAlpine

traits %>%
  select(-c(Plant.category, Lifespan, Reproduction.frequency, Dormancy, Seed.mass:GA3)) %>%
  cbind(pcaAlpine$ind$coord[, 1:2]) -> pcaInds

cent <- aggregate(cbind(Dim.1, Dim.2) ~ Alpine, data = pcaInds, FUN = mean)
segs <- merge(pcaInds, setNames(cent, c("Alpine", "oDim.1", "oDim.2")), by = "Alpine", sort = FALSE)

pcaAlpine$quanti.var$coord[, 1:2] %>%
  data.frame %>%
  rownames_to_column(var = "Variable") %>%
  mutate(Variable = fct_recode(Variable, `Seed mass` = "Seed.mass", 
                               `Embryo:endosperm` = "Embryo")) -> pcaVars

pcaAlpine$quali.var$coord[, 1:2] %>%
  data.frame %>%
  rownames_to_column(var = "Variable") %>%
  mutate(Variable = fct_recode(Variable, Annual = "annual", Perennial = "perennial",
                               Monocarpic =  "monocarp", Polycarpic = "polycarp")) -> pcaVars2

ggplot(pcaInds, aes(x = Dim.1, y = Dim.2)) +
  geom_point(aes(color = Alpine), alpha = 0.5, size = 2.5, shape = 15) +
  ggthemes::theme_tufte() + 
  theme(panel.background = element_rect(color = "grey96", fill = "grey96"),
        legend.position = "top", legend.title = element_blank(),
        legend.text = element_text(size = 7.5),
        legend.margin = margin(t = 0, r = 0, b = 0, l = 0, unit = "cm"),
        plot.margin = unit(x = c(0, 0, 0, 0), units = "cm"),
        text = element_text(size = 8)) +
  scale_color_manual(values = c("yellowgreen", "gold")) +
  scale_x_continuous(name = paste("Axis 1 (", round(pcaAlpine$eig[1, 2], 0),
                                  "% variance explained)", sep = "")) + 
  scale_y_continuous(name = paste("Axis 2 (", round(pcaAlpine$eig[2, 2], 0), 
                                  "% variance explained)", sep = "")) +
  geom_segment(data = pcaVars, aes(x = 0, y = 0, xend = 4*Dim.1, yend = 4*Dim.2)) +
  geom_label(data = pcaVars, aes(x = 4*Dim.1, y = 4*Dim.2, label = Variable), 
                  size = 2.5) +
  geom_label(data = pcaVars2, aes(x = 4*Dim.1, y = 4*Dim.2, label = Variable), 
             size = 2.5)

```


